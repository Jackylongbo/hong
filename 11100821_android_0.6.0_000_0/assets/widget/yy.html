<!DOCTYPE html>
<html class="um landscape min-width-240px min-width-320px min-width-480px min-width-768px min-width-1024px">
  <head>
    <title>
    </title>
    <meta charset="utf-8">
    <meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link rel="stylesheet" href="css/ui-img.css">
    <link rel="stylesheet" href="css/ui-list.css">
    <link rel="stylesheet" href="css/ui-input.css">
    <link rel="stylesheet" href="css/ui-res.css">
    <link rel="stylesheet" href="css/ui-btn.css">
    <link rel="stylesheet" href="css/ui-base.css">
    <link rel="stylesheet" href="css/ui-box.css">
    <link rel="stylesheet" href="css/ui-color.css">
    <script src="js/zy_control.js">
    </script>
    <script src="js/zy_click.js">
    </script>
    <script src="js/public.js">
    </script>
  </head>
<body class="um-vp">
<div id="main" class="uinn">
	
<!--列表开始-->
<div id="relist" class="b-gra c-wh us">  

</div>
<!--列表结束-->	
	
	
	
	
<div class="uinn">

<!--块容器开始-->
<div ontouchstart="zy_touch('btn-act')" class="ub ub-ver c-blu2 us uinn t-wh uc-a1 tx-c ulev2" onclick="getre();">	
<b>查看我的估价回复</b>
 </div>
<!--块容器结束-->
	
	
<!--块容器开始-->
<div class="ub umar-t ub-ver c-org us uinn t-wh uc-a1 tx-c ulev2" onclick="uexCall.dial('02162289595');">	
<b>咨询电话：021-62289595</b>
 </div>
<!--块容器结束-->
<!--块容器开始-->
<div class="ub uinn t-org">	
  <b>请在这里提供物品的详细描述，我们将尽快为您估价，谢谢！</b>
 </div>
<!--块容器结束-->
</div>

<!--块容器开始-->
<div class="ub ub-ver b-gra t-wh uinn">
<!--
<div class="ubb b-blu c-wh uinn uc-t1">
<div class="ub t-bla ulab">  
<div class="uinn ulim b2text">预约日期：</div> 
<div class="ub-f1 uc-a1 b-gra uinput uinn4">  
<input placeholder="必填" id="a1" name="a1" readonly onclick="opendate();" type="text" style="border:none;">   
</div>
</div>
</div>-->

<div class="ubb b-blu c-wh uinn ">
<!--文本开始-->
<div class="ub t-bla ulab">  
<div class="uinn ulim b2text">你的姓名：</div> 
<div class="ub-f1 uc-a1 b-gra uinput uinn4">  
<input placeholder="必填" id="a2" name="a2" type="text" style="border:none;">   
</div>
</div>
<!--文本结束-->
</div>

<div class="ubb b-blu c-wh uinn ">
<!--文本开始-->
<div class="ub t-bla ulab">  
<div class="uinn ulim b2text">手机号码：</div> 
<div class="ub-f1 uc-a1 b-gra uinput uinn4">  
<input placeholder="必填" id="a3" name="a3" type="text" style="border:none;">   
</div>
</div>
<!--文本结束-->
</div>

<div class="ubb b-blu c-wh uinn ">
<!--文本开始-->
<div class="ub t-bla ulab">  
<div class="uinn ulim b2text">物品描述：</div> 
<div class="ub-f1 uc-a1 b-gra uinput uinn4">
<textarea placeholder="必填" id="a5" name="a5" type="textarea" style="border:none;height:6em"></textarea>
</div>
</div>
<!--文本结束-->
</div>



<div class="ubb b-blu c-wh uinn ">
<div class="ub t-bla ulab">
最多支持四张图片上传，图片上传完成后，请点击提交按钮保存估价信息。
</div>
</div>

<div class="ubb b-blu c-wh uinn ">
<div class="ub t-bla ulab">
<div class="uinn ulim b2text">物品图一：</div> 
<div class="ub-f1 uc-a1 b-gra uinput">  
<input placeholder="选填/拍照或选择图片" readonly onclick="selimg(1);" id="img1" name="img1" type="text" style="border:none;">   
</div>
</div>
</div>

<div class="ubb b-blu c-wh uinn ">
<div class="ub t-bla ulab">
<div class="uinn ulim b2text">物品图二：</div> 
<div class="ub-f1 uc-a1 b-gra uinput uinn4">  
<input placeholder="选填/拍照或选择图片" readonly onclick="selimg(2);" id="img2" name="img2" type="text" style="border:none;">   
</div>
</div>
</div>

<div class="ubb b-blu c-wh uinn ">
<div class="ub t-bla ulab">
<div class="uinn ulim b2text">物品图三：</div> 
<div class="ub-f1 uc-a1 b-gra uinput uinn4">  
<input placeholder="选填/拍照或选择图片" readonly onclick="selimg(3);" id="img3" name="img3" type="text" style="border:none;">   
</div>
</div>
</div>

<div class="b-blu c-wh uinn ">
<div class="ub t-bla ulab">
<div class="uinn ulim b2text">物品图四：</div> 
<div class="ub-f1 uc-a1 b-gra uinput uinn4">  
<input placeholder="选填/拍照或选择图片" readonly onclick="selimg(4);" id="img4" name="img4" type="text" style="border:none;">   
</div>
</div>
</div>






</div>
</div>
<!--块容器结束-->
<!--按钮开始-->
<div ontouchstart="zy_touch('btn-act')" onclick="save();" class="btn c-m10 us b-gra uinn5 c-org uc-a ulev0 t-wh"><b>提　交</b></div>
<!--按钮结束-->
<br />

	
</div>
</body>
<script>
var postin=0;
var postcount=0;
var fileurl="";
var uploadimg="";
var datestr="";
var a1="";
var a2="";
var a3="";
var a4="";
var a5="";
var d = new Date();
var yearstr = d.getFullYear();
var monthstr = d.getMonth() + 1;
var daystr = d.getDate()+1;
//$$("a1").value=yearstr+"-"+monthstr+"-"+daystr+" 09:00";

window.uexOnload=function(type)
{
	if(!type){
		uexWindow.setBounce("1");
	}
}

function opendate(){
	//时间回调
uexControl.cbOpenTimePicker=function(opCode,dataType,data){
if(dataType==1){
var obj = eval('('+data+')');
var h=obj.hour;
if(h<10){h="0"+h;}
var m=obj.minute
if(m<10){m="0"+m;}
datestr+=" "+h+":"+m;
$$("a1").value=datestr;
}
}
//日期回调
uexControl.cbOpenDatePicker=function(opCode,dataType,data){
if(dataType==1){
var obj = eval('('+data+')');
datestr=obj.year+"-"+obj.month+"-"+obj.day;
//跳出时间
uexControl.openTimePicker (9, 0);
}
}

//默认为第二天上午九点。
uexControl.openDatePicker(yearstr,monthstr,daystr);
}

function save(){
	//var a1=$$("a1").value;
	a1="";
	a2=$$("a2").value;
	a3=$$("a3").value;
	if(ismobile(a3)==false){
		uexWindow.toast("0","5","手机号码格式不正确","2000");
		return;
	}
	a5=$$("a5").value;	
	if(a5=="" || a2=="" || a3==""){
		uexWindow.toast("0","5","姓名/手机号/物品描述不能为空...","3000");
		return false;
	}
	if (uploadimg==""){
		postyy(a1,a2,a3,a5);
	}
	else
	{
		uploadimg = uploadimg.substring(0, uploadimg.length - 1);//最后一个逗号去了。
		postyy(a1,a2,a3,a5);
	}
}

function postyy(d,name,mo,txt){
		uexWindow.toast("1","5","正在保存估价数据...","0");
		var url = json_http_url+"yysave.asp?action=yysaves&ydate="+encodeURIComponent(d)+"&txt="+encodeURIComponent(txt)+"&name="+encodeURIComponent(name)+"&tel="+mo+"&img="+encodeURIComponent(uploadimg)+"&wifiid="+localStorage.wifiid;
		//alert(url);
		uexXmlHttpMgr.onData = postyySuccess;
		uexXmlHttpMgr.open(2211, "post", url,"");
		uexXmlHttpMgr.send(2211);
}
function postyySuccess(opid,status,result){
		if (status == -1) {
			uexWindow.toast("0","5","服务器端出错或请求超时","3000");
		}
		if(status==1){
		uexXmlHttpMgr.close(2211);
		uexWindow.closeToast();
		//alert(result);
		if(result=="y"){
			uploadimg="";//上传图片为空
			postcount=0;//上传限制数量为0
			uexWindow.toast("0","5","估价成功！我们期待你的光临！","3000");
			setTimeout("uexWindow.statusBarNotification('通知','估价信息已经收到，稍后会有工作人员与您联系！');",5000);
			$$("a2").value="";
			$$("a3").value="";
			$$("a5").value="";
			$$("img1").value="";
			$$("img2").value="";
			$$("img3").value="";
			$$("img4").value="";
			//uexWindow.statusBarNotification("通知","估价信息已经收到，稍后会有工作人员与您联系！");
			}
	    }
}

var uploadHttp =  wwwurl+"uploadyy/Upfile_Photo.asp";

function selimg(invalue){
	a2=$$("a2").value;
	a3=$$("a3").value;
	a5=$$("a5").value;	
	if(a5=="" || a2=="" || a3==""){
		uexWindow.toast("0","5","上传图片前，请输入必填内容。","3000");
		return false;
	}
	if(postcount==4){
		uexWindow.toast("0","5","只能上传四张！请点击提交按钮，保存数据。","3000");
		return false;
	}

	uexWindow.cbActionSheet=function (opId, dataType, data)
	{
	if(data==0){
		imgopen(invalue);
	}
	if(data==1){
		paiopen(invalue);
	}

	}
	
	postin=invalue;
	var values = "相册图片上传;拍照上传";
	var mycarss=values.split(";");
	uexWindow.actionSheet("","关闭",mycarss);
}

function paiopen(invalue){
	uexCamera.cbOpen=function (opCode, dataType, data)
	{
	$$("img"+invalue).value=data;
	upload(data);
	}
	uexCamera.open();
	}

function imgopen(invalue){
	uexImageBrowser.cbPick=function (opCode,dataType,data)
	{
	$$("img"+invalue).value=data;
	upload(data);
	}
	uexImageBrowser.pick();
	}
	
function uexWidgetOneErrorCb(opCode, errorCode, errorInfo){
	uexWindow.toast('0','5',errorInfo,2000);
}

function UploaderMgronStatus(opCode,fileSize,percent,serverPath,status)
{
	switch (status)
	{
			case 0:
			uexWindow.toast('1','5',"上传进度:"+percent+"%",0);
			break;
			case 1:
				uexWindow.closeToast();
				uexUploaderMgr.closeUploader(opCode);
				fileurl=="";
				uploadimg+=serverPath+",";
				postcount++;//成功一次加一。
				uexWindow.toast('0','5',"上传图片成功!",2000);
				break;
			case 2:
				uexWindow.closeToast();
				uexWindow.toast('0','5',"上传失败",2000);
				uexUploaderMgr.closeUploader(opCode);
				break;
		}
}

function UploaderMgrCreateUploaderCb(opCode,dataType,data){
	if(data == 0){
		var path=fileurl;
		if(path==""){return;}		
		uexUploaderMgr.onStatus = UploaderMgronStatus;
		var inCompress = '1';
		uexUploaderMgr.uploadFile(opCode,path,"FileName",inCompress);
	}else{
		uexWindow.closeToast();
		uexWindow.toast('0','5',"上传失败",2000);
	}
}

function upload(file)
{
	fileurl=file;
	uexWidgetOne.cbError = uexWidgetOneErrorCb;
	uexUploaderMgr.cbCreateUploader = UploaderMgrCreateUploaderCb;
	uexWindow.toast('1','5','正在上传图片...','');
	uexUploaderMgr.createUploader('1',uploadHttp);
}


function getre(){
		uexWindow.toast("0","5","正在获取...","0");
		var url = json_http_url+"yyrelist.asp";
		uexXmlHttpMgr.onData = getreSuccess;
		uexXmlHttpMgr.open(5555, "get", url,"");
		uexXmlHttpMgr.send(5555);
}

function getreSuccess(opid,status,result){
		if (status == -1) {
			uexWindow.toast("0","5","服务器端出错或请求超时","3000");
		}
		if(status==1){
		uexXmlHttpMgr.close(5555);
		uexWindow.closeToast();
		if(result=="[]"){uexWindow.toast("0","5","目前暂无估价回复","2000");}
		else{showre(result);}
	    }
}

function showre(str){
	//alert(str);
	var json = eval(str);
	var i=0;
	var html="";
	for (i;i<json.length;i++){
		html+="<ul ontouchstart=zy_touch('btn-act') class='uc-t ubb ub b-gra c-m2 t-bla ub-ac umh4 lis'>";
		html+="<li class='ub-f1 ut-s'>"+json[i].retxt+"<br />"+json[i].retime+"</li>";
		html+="</ul>";
	}
	$$("relist").innerHTML=html;
}

function ismobile(m){
var reg =/^0?(13[0-9]|15[012356789]|18[0236789]|14[57])[0-9]{8}$/;
if(!m.match(reg)) return false;
return true;
}
</script>
<script src="js/go.js"></script>
</html>