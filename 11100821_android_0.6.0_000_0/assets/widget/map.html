<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<style type="text/css">
body, html,#allmap {width: 100%;height: 100%;overflow: hidden;margin:0;}
#l-map{height:100%;width:78%;float:left;border-right:2px solid #bcbcbc;}
#r-result{height:100%;width:20%;float:left;}
</style>
<script type="text/javascript" src="http://api.map.baidu.com/api?v=1.5&ak=473df449595ba28f9f0350d8e91665bb"></script>
<script type="text/javascript" src="map/convertor.js"></script>
<link rel="stylesheet" href="map/bmap.css">

</head>
<body >
<div id="container" style="position:absolute;width:100%;height:100%;left:0px;top:0px;margin:0px"></div>
<div id="allmap"></div>
</body>
<script>
var endstr1="121.402855";
var endstr2="31.215417";

window.uexOnload = function(type){

	getmap();
	getlocal();
	//a();
	//alert("map");
}

function getmap(){
	var bm = new BMap.Map("container");
	var point = new BMap.Point(endstr1, endstr2);
	bm.centerAndZoom(point, 18);
	bm.addControl(new BMap.NavigationControl());
	var marker = new BMap.Marker(point);
	bm.addOverlay(marker);
	bm.setCenter(point);
}

function getlocal(){
		uexLocation.onChange=function(inLat,inLog){
			gpsxy(inLog,inLat);//纬度与经度相反的。
			//alert(inLog+""+inLat);
		}
		uexLocation.openLocation();
}

gpsxy=function(x,y){
	if(x==""){return;}
	else{uexLocation.closeLocation();}
    var xx = x;
    var yy = y;
    var gpsPoint=new BMap.Point(xx,yy);
    BMap.Convertor.translate(gpsPoint,0,translateCallback);
}

translateCallback=function(point){
	var str1_tr=point.lng;
	var str2_tr=point.lat;
	//得到了转换后的正确经度与纬度
	mapshow(str1_tr,str2_tr);
}

function mapshow(str1,str2){
	//alert(str1);
	//alert(str2);
	if(str1=="" || str2==""){uexWindow.toast("0","5","无法得到你的GPS信息，导航不能完成。","3000");return;}
	var map=new BMap.Map("allmap");
	map.centerAndZoom(new BMap.Point(endstr1,endstr2),18);
	var p1=new BMap.Point(str1,str2);
	var p2=new BMap.Point(endstr1,endstr2);
	var driving=new BMap.DrivingRoute(map,{renderOptions:{map:map,autoViewport:true}});
	driving.search(p1,p2);
}


function a(){
	
var map = new BMap.Map("allmap");
map.centerAndZoom(new BMap.Point(116.404, 39.915), 11);

var p1 = new BMap.Point(116.301934,39.977552);
var p2 = new BMap.Point(116.508328,39.919141);
var driving = new BMap.DrivingRoute(map, {renderOptions:{map: map, autoViewport: true}});
driving.search(p1, p2);

}

</script>
</html>