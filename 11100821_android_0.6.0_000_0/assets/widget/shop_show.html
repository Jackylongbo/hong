<!DOCTYPE html>
<html class="um landscape min-width-240px min-width-320px min-width-480px min-width-768px min-width-1024px">
  <head>
    <title>
    </title>
    <meta charset="utf-8">
    <meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link rel="stylesheet" href="css/ui-input.css">
    <link rel="stylesheet" href="css/ui-btn.css">
    <link rel="stylesheet" href="css/ui-img.css">
    <link rel="stylesheet" href="css/ui-res.css">
    <link rel="stylesheet" href="css/ui-list.css">
    <link rel="stylesheet" href="css/ui-base.css">
    <link rel="stylesheet" href="css/ui-box.css">
    <link rel="stylesheet" href="css/ui-color.css">
	<link rel="stylesheet" href="app.css">
    <script src="js/zy_control.js">
    </script>
    <script src="js/zy_click.js">
    </script>
    <script src="js/public.js">
    </script>
	<script src="js/ts.js">
</script>
  </head>
<body>
<div id="main">

<div class="top_gg_box ty1 center">
  <ul id="s3">
    <!--<li style='display:block;'><div><img src='images/top_gg1.jpg'></div></li>
    <li style='display:none;'><div><img src='images/top_gg1.jpg'></div></li>
    <li style='display:none;'><div><img src='images/top_gg1.jpg'></div></li>-->
  </ul>

</div>



<div id="list">
<!--块容器开始-->
<div class="ub ub-ver uba b-gra">	



<div class="ubb b-gra c-m1 uinn" id="pname">商品名称：</div>
<div class="ubb b-gra c-m1 uinn" id="pj">会员价格：</div>
<div class="ubb b-gra c-m1 uinn t-gra" id="other">其它说明：<br /></div>
<div class="c-m1 uinn">
	
	<!--按钮开始-->
<div ontouchstart="zy_touch('btn-act')" onclick="wb();" class="btn ulim uba b-gra us uinn5 c-blu2 c-m1 uc-a">分享商品</div>
<!--按钮结束-->
	<br />
<!--按钮开始-->
<div ontouchstart="zy_touch('btn-act')" id="ljsave" onclick='$$("reg").style.display="";$$("ljsave").style.display="none";' class="btn ulim uba b-gra us uinn5 c-org c-m1 uc-a">立即购买</div>
<!--按钮结束-->
</div> 
</div>
<!--块容器结束-->
</div>

<div id="reg" class="uinn">
<!--文本开始-->
<div class="uba uc-a1 b-gra us-i uinput uinn4 umar-t">    
 <input placeholder="请输入联系人" id="xm" name="xm" type="text" class="uc-a1">   
</div>  
<!--文本结束-->
<!--文本开始-->
<div class="uba uc-a1 b-gra us-i uinput uinn4 umar-t">    
 <input placeholder="请输入手机号码" id="mo" name="mo" type="text" class="uc-a1">   
</div>  
<!--文本结束-->
<!--文本开始-->
<div class="uba uc-a1 b-gra us-i uinput uinn4 umar-t">    
 <input placeholder="请输入正确的地址" id="addr" name="addr" type="text" class="uc-a1">   
</div>  
<!--文本结束-->





<!--按钮开始-->
<div ontouchstart="zy_touch('btn-act')" onclick="savereg();" class="btn ulim uba b-gra us uinn5 c-org c-m1 uc-a umar-t">提交购买</div>
<!--按钮结束-->
</div>

<div id="yz" class="uinn">
<!--文本开始-->
<div id="yzm" class="uinn"></div>
<div class="uba uc-a1 b-gra us-i uinput uinn4 umar-t">    
 <input placeholder="请输入验证码：" name="yzcode" id="yzcode" type="text" class="uc-a1">   
</div>  
<!--文本结束-->
<!--按钮开始-->
<div ontouchstart="zy_touch('btn-act')" onclick="saveorder();" class="btn ulim uba b-gra us uinn5 c-org c-m1 uc-a umar-t">确认验证</div>
<!--按钮结束-->
</div>

<div id="goumai" class="uinn">
<!--块容器开始-->
<div class="ub ub-ver uinn">	
名称：<span id="pp1" class='t-blu'></span><br />
价格：<span id="pp2" class='t-blu'></span>元
 </div>
<!--块容器结束-->
<!--按钮开始-->
<div ontouchstart="zy_touch('btn-act')" onclick="gopay();" class="btn ulim uba b-gra us uinn5 c-org c-m1 uc-a umar-t">付款购买</div>
<!--按钮结束-->
</div>


<br /><br /><br /><br />
</div>
</body>
<script>
var allimg="";
localStorage.ispay="n";
var imgurl="";//图片地址
var shopid=localStorage.shopid;//商品ID
$$("list").style.display="none";
$$("reg").style.display="none";
$$("yz").style.display="none";
$$("goumai").style.display="none";
var sjm=getrnd(4);//验证码
$$("yzm").innerHTML="验证码："+sjm;

var z=0;
var shopname="";//商品名称
var shopprice=0;//商品价格
var ordernum="";//订单编号

window.uexOnload=function(type){
	uexPay.onStatus = paySuccess;
	getall();
	uexWindow.setBounce("1");
}

function getall(){
		uexWindow.toast("1","5","正在获取...","0");
		var url = "http://www.epawn.cn/json_app/shopshow.asp?id="+shopid;
		//alert(url);
		uexXmlHttpMgr.onData = getallSuccess;
		uexXmlHttpMgr.open(777, "get", url,"");
		uexXmlHttpMgr.send(777);
}

function getallSuccess(opid,status,result){

		if (status == -1) {
			uexWindow.toast("0","5","服务器端出错或请求超时","3000");
		}
		if(status==1){
		uexXmlHttpMgr.close(777);
		uexWindow.closeToast();
		if(result=="[]"){uexWindow.toast("0","5","没有找到相关商品信息","2000");}
		else{showhtml(result);}
	    }
}

function showhtml(str){
	//alert(str);
	var json = eval(str);
	var html="";
	if(json.length==1){
		$$("pname").innerHTML+=json[0].productname;
		shopname=json[0].productname;
		$$("pj").innerHTML+=json[0].jiage+"元";
		shopprice=json[0].jiage;
		$$("other").innerHTML+=json[0].content;
		var url="http://www.epawn.cn/kjadmin/uploadpic/";
		if(json[0].pic5!==""){allimg=url+json[0].pic5;}
		if(json[0].pic6!==""){allimg=allimg+","+url+json[0].pic6;}
		if(json[0].pic7!==""){allimg=allimg+","+url+json[0].pic7;}
		if(json[0].pic8!==""){allimg=allimg+","+url+json[0].pic8;}
		//allimg=url+json[0].pic5+","+url+json[0].pic6+","+url+json[0].pic7+","+url+json[0].pic8;
		html+="<li onclick=oimg('0')><img src='"+url+json[0].pic+"' height='100%' ></li>";
if(json[0].pic6 !="" && json[0].pic6 !=null){
	html+="<li onclick=oimg('1')><img src='"+url+json[0].pic2+"' height='100%' ></li>";
}

if(json[0].pic7 !="" && json[0].pic7 !=null){
	html+="<li onclick=oimg('2')><img src='"+url+json[0].pic3+"' height='100%' ></li>";
}

if(json[0].pic8 !="" && json[0].pic8 !=null){
	html+="<li onclick=oimg('3')><img src='"+url+json[0].pic4+"' height='100%' ></li>";
}
$$("list").style.display="";
$$("s3").innerHTML=html;
//alert(html);
h();
		
	}
}

function oimg(img){
	if (img==""){return}
	else{
		uexImageBrowser.open(allimg,img,1);
	}
}


function savereg(){
	xm=$$("xm").value;
	mo=$$("mo").value;
	addr=$$("addr").value;
	if(xm=="" || mo=="" || addr==""){
		uexWindow.toast("0","5","姓名/手机号/地址信息为必填项","2000");
		return false;
	}
	
	if(ismobile(mo)==false){
		uexWindow.toast("0","5","错误的手机号码","2000");
		return false;
	}
	localStorage.regxm=xm;
	localStorage.regmo=mo;
	localStorage.regaddr=addr;	
	
		uexWindow.toast("0","5","正在提交保存...","0");
		var url = "http://www.epawn.cn/json_app/shop_saveuser.asp?name="+encodeURIComponent(xm)+"&mobile="+mo+"&sjm="+sjm+"&addr="+encodeURIComponent(addr);
		uexXmlHttpMgr.onData = saveregSuccess;
		uexXmlHttpMgr.open(332, "get", url,"");
		uexXmlHttpMgr.send(332);
}
function saveregSuccess(opid,status,result){
		if (status == -1) {
			uexWindow.toast("0","5","服务器端出错或请求超时","3000");
		}
		if(status==1){
		uexXmlHttpMgr.close(332);
		uexWindow.closeToast();
		tipreg(result);	
	    }
}

function tipreg(str){
	//alert(str);
	var json = eval(str);
	if (json.length==1){
		localStorage.reguid=json[0].id;
		$$("reg").style.display = "none";
		$$("yz").style.display = "";
	}
	else{uexWindow.toast("0","5","保存失败，请稍候再试。","3000");}
}

function saveorder(){
	var newsjm=$$("yzcode").value;
	if(newsjm !=sjm ){
		uexWindow.toast("0","5","错误的验证码","2000");
		return false;
	}
		uexWindow.toast("0","5","正在保存订单...","0");
		var url = "http://www.epawn.cn/json_app/shop_saveorder.asp?uid="+localStorage.reguid+"&shopid="+shopid;
		uexXmlHttpMgr.onData = saveorderSuccess;
		uexXmlHttpMgr.open(3355, "get", url,"");
		uexXmlHttpMgr.send(3355);
}

function saveorderSuccess(opid,status,result){
		if (status == -1) {
			uexWindow.toast("0","5","服务器端出错或请求超时","3000");
		}
		if(status==1){
		uexXmlHttpMgr.close(3355);
		uexWindow.closeToast();
		tiporder(result);	
	    }
}

function tiporder(str){
	var json = eval(str);
	if (json.length==1){
		ordernum=json[0].dingdanhao;
		$$("reg").style.display = "none";
		$$("yz").style.display = "none";
		$$("goumai").style.display = "";
		$$("pp1").innerHTML=shopname;
		$$("pp2").innerHTML=shopprice;
	}
	else{uexWindow.toast("0","5","保存订单失败，请稍候再试。","3000");}
}


function gopay(){
var num = ordernum;
var subject = shopname;
var bodystr = shopname;
var money = shopprice;
//var money=0.1;//测试完成以后，变量值为shopprice，注释此行即可
if (uexWidgetOne.platformName == "iOS") {
	uexPay.setPayInfo('2088002437685162', '2088002437685162', 'MIICdwIBADANBgkqhkiG9w0BAQEFAASCAmEwggJdAgEAAoGBANReqfl935vagHHq7hbEVoqP+Sem8/HJta28UFeeUSUGn4ltYWUdTkzR6ceG0av+T3sVbgJTz/Rpivf5AgJQjo7/dxKKcz3ToFBA34iAMVbvOxwwP9jl0q+WjLfNC1fv6Yu0gypQWxqxYy2LN2lAbgYD6Z4PsABpRDQIXyRRLBadAgMBAAECgYEAz5wLhr+rDe25i6QjRVaDU8oTxNPNvx114nYqBL3cjdm/tNWdVQAlP6wmYsxFxWJDyQvWE6hjr4hONsTTVffyo8jORF05FLhAFx0RG3ffk0sK8HD4y1WeUFFAlEoSUgu8oLJWH6MMDSD1Bs8MzhJvU3BG/NBKIKFyW8QXSO+PlgECQQDuxUvXjAimncOmcjg0bAN/ISSrfjD+t0iR99KVY6DQVPRq49qiGrVnHBQUy9EzRgGXcmRRTpAFoCba+orYfph9AkEA47Gs88W/XBOjOwYDZdOyr6xHCNG3s0iUI8LK3eZqjnW99GO8EqRifTT93A7O3DXybau1nW2I1DaYTLk1oU3woQJARNJle+mHDM9od29wt9tyXpBlC3FCGgkmR7yQ3DJtRd9W3AB1IkhkhSXYu+3LjOXey5JTTARDCvwQdwnEP4at2QJBAKDz/RVJKQ82loFnq8k0T7Cc8I3MabXjTUzGKs+XTKWtl3yFb/Ihn7lwVy9SjGnf/KIH6lcBkeKpQRmjJsUCqmECQHwOVUQT9p770juou5DdRg8IWbGi4u8PFy3X9/d4SRDTE9zr20ZIPxEzIPgPFz2z9OTW7QnuKxPnxpcb3c2n19k=', 'MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCabCscKaES8C3+XyL3Efy/wDhk8bPSIetoYOQdF4OArtcNZTPF6SEEMS4FYUVF9lagYBe3GJz+2Uoo7gBLnAdNyByROHG7ogtZVKDyje1G4Rq7GBPb8PtGoA+yIh2mekP/WHf2J6xbuIp5NbEhnY1yJK+Fy2vNXtkRgyMx92uLOQIDAQAB', 'http://www.epawn.cn/json_app/callback_pay.asp');
}
uexPay.pay(num, subject, bodystr, money);
localStorage.ispay="y";
}

function paySuccess(status,des){
if(des==""){des="未知";}
if(status==0){alert("支付成功！稍后将有工作人员联系您！");//android才有此状态
}
else{
	if (z > 0 && status != 1 ) {alert("支付没有完成，原因：" + des);}
}

if(status==1 && uexWidgetOne.platformName == "iOS"){
	isget();//IOS下面的支付状态需要到服务器上得到
}
z++;
}

function isget(){
	uexWindow.toast("1","5","正在检测支付状态，请不要离开...","2000");
	setTimeout('getpay();', 2000);
}

function getpay(){
		uexWindow.toast("0","5","正在获取支付状态...","0");
		var url = "http://www.epawn.cn/json_app/getpay.asp?h="+ordernum;
		uexXmlHttpMgr.onData = getpaySuccess;
		uexXmlHttpMgr.open(2221, "get", url,"");
		uexXmlHttpMgr.send(2221);
}

function getpaySuccess(opid,status,result){
		if (status == -1) {
			uexWindow.toast("0","5","服务器端出错或请求超时","3000");
		}
		if(status==1){
		uexXmlHttpMgr.close(2221);
		uexWindow.closeToast();
		tipgetpay(result);	
	    }
}

function tipgetpay(str){
	localStorage.ispay="n";//重置状态
	var json = eval(str);
	if (json.length==1){
		var zstr=json[0].zhuantai;
		if(zstr==2){
			uexWindow.alert("提示","支付成功，稍候将有工作人员与你联系！","好的");
		}
		else{uexWindow.alert("提示","支付没有成功，请稍候再试。如有疑问，请与典当行联系。","确定");}
	}
	else{uexWindow.alert("提示","支付没有成功，请稍候再试。如有疑问，请与典当行联系。","确定");}
}

function getrnd(n) {
	var str="";
    for(var i = 0; i < n ; i ++) {
        str+= Math.floor(Math.random()*10);
    }
    return str;
}

function ismobile(m){ 
var reg =/^0?(13[0-9]|15[012356789]|18[0236789]|14[57])[0-9]{8}$/; 
if(!m.match(reg)) return false; 
return true;
}



function h(){
	//图片滑动
	console = window.console ||
	{
		dir: new Function(),
		log: new Function()
	};
	var active = 0;
	//var t3 = new TouchSlider('s3', {
	//	speed: 500,
	//	timeout: 3000,
	//	mouseWheel: true
	//});
	
	
	var t4 = new TouchSlider({
		id: 's3',
		speed: 500,
		timeout: 3000,
		fixWidth:true
	});
}


function wb(){
	uexWindow.cbActionSheet=function (opId, dataType, data)
	{
	if(data == 0)
	{
		openwb('wb_sina.html');
	}
	else if(data == 1)
	{
		openwb('wb_qq.html');
	}
	}
	localStorage.sharestr="恒通典当行商城  网址：http://www.epawn.cn/";
	var value = "分享到新浪微博;分享到腾讯微博";
	var mycars=value.split(";");
	uexWindow.actionSheet("","取消",mycars);
}

function openwb(url){
uexWindow.open("wb", '0', url, 2, '', '', 0x4);
}
</script>
<script src="js/go.js"></script>
</html>